<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 2.0.0-M10 from src/site/apt/realms.apt.vm at 2024-07-05
 | Rendered using Apache Maven Fluido Skin 2.0.0-M6
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 2.0.0-M10" />
    <meta name="author" content="Michael Osipov" />
    <meta name="date" content="2013-08-04" />
    <title>SPNEGO/Kerberos Authenticator and Active Directory Realm for Apache Tomcat – Realms</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-2.0.0-M6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-2.0.0-M6.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h1>SPNEGO/Kerberos Authenticator and Active Directory Realm for Apache Tomcat</h1>
</div>
</div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2024-07-05<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 4.2.0</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">SPNEGO/Kerberos Authenticator and Active Directory Realm for Apache Tomcat</li>
    <li><a href="index.html" title="About"><span class="none"></span>About</a></li>
    <li><a href="download.html" title="Download"><span class="none"></span>Download</a></li>
    <li><a href="user-guide.html" title="User Guide"><span class="icon-chevron-down"></span>User Guide</a>
     <ul class="nav nav-list">
      <li><a href="authenticators.html" title="Authenticators"><span class="none"></span>Authenticators</a></li>
      <li class="active"><a><span class="none"></span>Realms</a></li>
      <li><a href="sample-webapp.html" title="Sample Webapp"><span class="none"></span>Sample Webapp</a></li>
      <li><a href="spring-security.html" title="Spring Security"><span class="none"></span>Spring Security</a></li>
     </ul></li>
   <li class="nav-header">Modules</li>
    <li><a href="tomcat85-authnz-spnego-ad/index.html" title="SPNEGO/Kerberos Authenticator and Active Directory Realm for Apache Tomcat 8.5 (retired)"><span class="none"></span>SPNEGO/Kerberos Authenticator and Active Directory Realm for Apache Tomcat 8.5 (retired)</a></li>
    <li><a href="tomcat90-authnz-spnego-ad/index.html" title="SPNEGO/Kerberos Authenticator and Active Directory Realm for Apache Tomcat 9.0"><span class="none"></span>SPNEGO/Kerberos Authenticator and Active Directory Realm for Apache Tomcat 9.0</a></li>
    <li><a href="tomcat101-authnz-spnego-ad/index.html" title="SPNEGO/Kerberos Authenticator and Active Directory Realm for Apache Tomcat 10.1"><span class="none"></span>SPNEGO/Kerberos Authenticator and Active Directory Realm for Apache Tomcat 10.1</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="https://maven.apache.org/" title="Apache Maven" class="builtBy"><img class="builtBy"  alt="Built by Apache Maven" src="https://maven.apache.org/images/logos/maven-feather.png" style="" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<section>
<h1>Choosing and Using Realms</h1>
<p>After the authenticator has established a user's identity, it's time to retrieve it. Usually, the <a href="#Active_Directory_Realm"><code>ActiveDirectoryRealm</code></a> and <a href="#PAC_Data_Active_Directory_Realm"><code>PacDataActiveDirectoryRealm</code></a> will do, but for testing purposes you will find the <a href="#Using_a_Realm_for_Testing_Purposes"><code>UserDatabaseRealm</code></a> very handy.</p>
<dl>
<dt>Tip</dt>
<dd>I strongly recommend to try the <a href="#Using_a_Realm_for_Testing_Purposes"><code>UserDatabaseRealm</code></a> first, you'll see whether the authenticator works at all. If it does, go on with the productive realms.</dd></dl><section>
<h2>Active Directory Realm</h2>
<p>The <a href="./tomcat90-authnz-spnego-ad/apidocs/net/sf/michaelo/tomcat/realm/ActiveDirectoryRealm.html"><code>ActiveDirectoryRealm</code></a> will query your Active Directory via LDAP for a user by the <a href="./tomcat90-authnz-spnego-ad/apidocs/net/sf/michaelo/tomcat/realm/ActiveDirectoryRealm.html#on-usernames">string name type of the supplied username</a> and retrieve all the necessary information, e.g., his/her security groups.</p>
<p>It requires a two-step setup: First, you will need to configure a <code>DirContextSourceFactory</code> with the parameters of your Active Directory. Second, the realm itself pointing to that Active Directory.</p><section>
<h3>Configuring a Directory Context Source Factory</h3>
<p>Please read the documentation of the <a class="externalLink" href="https://michael-o.github.io/dirctxsrc/dircontextsourcefactory.html"><code>DirContextSourceFactory</code></a> on how to configure it in detail. Here is a minimal working configuration:</p>
<dl>
<dt>Tip</dt>
<dd>Never rely on hard-coded hostnames, use my <a class="externalLink" href="https://michael-o.github.io/activedirectory-dns-locator/"><code>ActiveDirectoryLdapDnsProvider</code></a> to auto-locate servers for Active Directory via DNS.</dd></dl>
<div class="verbatim source"><pre class="prettyprint">[&#x2026;]
  &lt;!-- Add this --&gt;
  &lt;Resource name=&quot;my-active-directory&quot; type=&quot;net.sf.michaelo.dirctxsrc.DirContextSource&quot;
    factory=&quot;net.sf.michaelo.dirctxsrc.DirContextSourceFactory&quot;
    urls=&quot;ldap://ad.example.com&quot; auth=&quot;gssapi&quot; loginEntryName=&quot;my-client&quot; /&gt;
[&#x2026;]
</pre></div></section><section>
<h3>Referral Handling</h3>
<p>In general, you should pick LDAP URLs which avoid any referral chasing because it amplifies execution in space and time. You are highly recommended using the Global Catalog (port 3268) only. More details on how this realm deals with referrals can be found in the <a href="./tomcat90-authnz-spnego-ad/apidocs/net/sf/michaelo/tomcat/realm/ActiveDirectoryRealm.html#referral-handling">Javadoc</a>.</p></section><section>
<h3>Configuring the Realm</h3>
<p>Now we need to wire that to the realm. Open or create your app's <code>context.xml</code> and add:</p>
<div class="verbatim source"><pre class="prettyprint">&lt;Context&gt;
[&#x2026;]
  &lt;!-- Add this --&gt;
  &lt;Realm className=&quot;net.sf.michaelo.tomcat.realm.ActiveDirectoryRealm&quot;
    dirContextSourceName=&quot;my-active-directory&quot; localDirContextSource=&quot;true|false&quot; /&gt;
[&#x2026;]
&lt;/Context&gt;
</pre></div>
<p>Provide the <code>dirContextSourceName</code> you have configured for the <code>DirContextSource</code> above and hint whether this directory context source has been configured <a class="externalLink" href="https://michael-o.github.io/dirctxsrc/dircontextsourcefactory.html#Resource_Declaration_Examples">locally or globally</a>. Default value is <code>false</code>.</p>
<p>You have successfully configured the <code>ActiveDirectoryRealm</code> in your webapp. It is now ready to use.</p></section><section>
<h3>Authenticated Principal</h3>
<p>After successful authentication and retrieval, this realm will create an <code>ActiveDirectoryPrincipal</code> with several attributes. Refer to the <a href="./tomcat90-authnz-spnego-ad/apidocs/net/sf/michaelo/tomcat/realm/ActiveDirectoryPrincipal.html">Javadoc</a> for details.</p>
<dl>
<dt>Important</dt>
<dd>If you intend to authenticate with the <code>SSLAuthenticator</code> your client certificates must contain a subject alternative name type 0 (<code>otherName</code>) with the type OID 1.3.6.1.4.1.311.20.2.3 (<code>msUPN</code>).</dd></dl></section><section>
<h3>Using Security Groups from Active Directory</h3>
<p>The <code>ActiveDirectoryRealm</code> will populate all roles as SID strings for the given principal by default. While it might not look convenient in the first place, it adds benefit when security groups are moved from/to other domains, the SID history is completely retained. I.e., your application will continue to work even with the old SID. If you would like to map SIDs to developer-friendly role names, checkout the <a class="externalLink" href="https://tomcat.apache.org/tomcat-9.0-doc/config/listeners.html#Properties_Role_Mapping_Listener_-_org.apache.catalina.core.PropertiesRoleMappingListener"><code>PropertiesRoleMappingListener</code></a> or use other role formats, but the SID see extended capabilities of this realm in the <a href="./tomcat90-authnz-spnego-ad/apidocs/net/sf/michaelo/tomcat/realm/ActiveDirectoryRealm.html#configuration">Javadoc</a>.</p></section></section><section>
<h2>PAC Data Active Directory Realm</h2>
<p>The <a href="./tomcat90-authnz-spnego-ad/apidocs/net/sf/michaelo/tomcat/realm/PacDataActiveDirectoryRealm.html"><code>PacDataActiveDirectoryRealm</code></a> will process <a class="externalLink" href="https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-pac/166d8064-c863-41e1-9c23-edaaa5f36962">MS-PAC</a> data from your Active Directory for a user and retrieve all the necessary information, e.g., his/her security groups.</p>
<p>It requires a single-step setup.</p>
<dl>
<dt>Note</dt>
<dd>Unsure about this realm? Use the <a href="./tomcat90-authnz-spnego-ad/apidocs/net/sf/michaelo/tomcat/realm/Krb5AuthzDataDumpingActiveDirectoryRealm.html"><code>Krb5AuthzDataDumpingActiveDirectoryRealm</code></a> (which wraps the <code>ActiveDirectoryRealm</code>) to collect authorization data and analyze it with the <a href="./tomcat90-authnz-spnego-ad/apidocs/net/sf/michaelo/tomcat/pac/Krb5AuthzDataDumpPrinter.html"><code>Krb5AuthzDataDumpPrinter</code></a>.</dd></dl><section>
<h3>Configuring the Realm</h3>
<p>Open or create your app's <code>context.xml</code> and add:</p>
<div class="verbatim source"><pre class="prettyprint">&lt;Context&gt;
[&#x2026;]
  &lt;!-- Add this --&gt;
  &lt;Realm className=&quot;net.sf.michaelo.tomcat.realm.PacDataActiveDirectoryRealm&quot;
    loginEntryName=&quot;a-login-entry&quot; /&gt;
[&#x2026;]
&lt;/Context&gt;
</pre></div>
<p>Provide the <code>loginEntryName</code> you have configured for the <code>SpnegoAuthenticator</code> before.</p>
<p>You have successfully configured the <code>PacDataActiveDirectoryRealm</code> in your webapp. It is now ready to use.</p></section><section>
<h3>Authenticated Principal</h3>
<p>After successful authentication and retrieval, this realm will create an <code>ActiveDirectoryPrincipal</code> with several attributes. Refer to the <a href="./tomcat90-authnz-spnego-ad/apidocs/net/sf/michaelo/tomcat/realm/ActiveDirectoryPrincipal.html">Javadoc</a> for details.</p></section><section>
<h3>Using Security Groups from Active Directory</h3>
<p>The <code>PacDataActiveDirectoryRealm</code> will populate all roles as SID strings for the given principal by default. While it might not look convenient in the first place, it adds benefit when security groups are moved from/to other domains, the SID history is completely retained. I.e., your application will continue to work even with the old SID. If you would like to map SIDs to developer-friendly role names, checkout the <a class="externalLink" href="https://tomcat.apache.org/tomcat-9.0-doc/config/listeners.html#Properties_Role_Mapping_Listener_-_org.apache.catalina.core.PropertiesRoleMappingListener"><code>PropertiesRoleMappingListener</code></a>.</p></section></section><section>
<h2>Using a Realm for Testing Purposes</h2>
<p>In most cases you are not able to modify Active Directory entries easily (usually admins can), e.g., adding and removing groups or their members. Therefore, you can use the <a class="externalLink" href="https://tomcat.apache.org/tomcat-9.0-doc/realm-howto.html#UserDatabaseRealm"><code>UserDatabaseRealm</code></a>, fiddle quickly with users and roles to test your application.</p>
<p>Follow the Tomcat documentation and configure a <code>tomcat-users.xml</code> file with the according resource declaration. Type in the user and group principals, but leave the passwords out.</p>
<p>Open or create your app's <code>context.xml</code> and add:</p>
<div class="verbatim source"><pre class="prettyprint">&lt;Context&gt;
[&#x2026;]
  &lt;!-- Add this --&gt;
  &lt;Realm className=&quot;org.apache.catalina.realm.UserDatabaseRealm&quot;
    resourceName=&quot;UserDatabase&quot; stripRealmForGss=&quot;false&quot; /&gt;
[&#x2026;]
&lt;/Context&gt;
</pre></div>
<p>You have successfully configured the <code>UserDatabaseRealm</code> in your webapp. It is now ready to use.</p></section><section>
<h2>Alternative Realm Implementations</h2>
<p>If you are not using Active Directory as a user repository (e.g. database or another directory server) and can still make use of this library. Extend Tomcat's <a class="externalLink" href="https://tomcat.apache.org/tomcat-9.0-doc/api/org/apache/catalina/realm/RealmBase.html"><code>RealmBase</code></a> class and override any of these methods:</p>
<ul>
<li><a class="externalLink" href="https://tomcat.apache.org/tomcat-9.0-doc/api/org/apache/catalina/realm/RealmBase.html#getPrincipal(org.ietf.jgss.GSSName,org.ietf.jgss.GSSCredential)"><code>protected Principal getPrincipal(GSSName, GSSCredential)</code></a>,</li>
<li><a class="externalLink" href="https://tomcat.apache.org/tomcat-9.0-doc/api/org/apache/catalina/realm/RealmBase.html#getPrincipal(java.security.cert.X509Certificate)"><code>protected Principal getPrincipal(X509Certificate userCert)</code></a>.</li></ul></section></section><section>
<h1>Next Step</h1>
<p>You have freed your users from typing usernames and passwords over and over again. Go on and try your new <a href="./sample-webapp.html">SSO setup</a>.</p></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p class="pull-right">©      2013–2024
<a href="https://github.com/michael-o">Michael Osipov</a>
</p>
        </div>
      </div>
    </footer>
<script>
  if(anchors) {
    anchors.add();
  }
</script>
  </body>
</html>